/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/JS
*
*  @version 0.2.0
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r,s="object"==typeof module&&module.exports,i="function"==typeof define&&define.amd;s?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:i&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,s){return n.call(e,{AMD:s})}):t in e||(e[t]=r=n.call(e,{})||1)&&i&&define(t,[],function(){return r})}(this,"Importer",function(){"use strict";function e(e,t){var n,r,s,i,a,l=typeof t;if("object"===l){r=0;for(n in t)t[c](n)&&(s=t[n],i=s.selector,a=[].concat(s.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(i+"{"+a+"}",r),s.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(i,a,r),s.css=e.sheet.rules[r]),r++)}else"string"===l&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function t(t,n,r){var s,i,a=null,l=null;switch(t){case"tpl-link":case"tpl":a=document.createElement("script"),a[o]("type","text/x-tpl"),a.appendChild(document.createTextNode(n)),document.head.appendChild(a);break;case"script-link":if(r)for(i=document.head.getElementsByTagName("script"),s=i.length-1;s>=0;s--)if(i[s].src&&n===i[s].src){l=i[s];break}l?a=l:(a=document.createElement("script"),a[o]("type","text/javascript"),a[o]("language","javascript"),a[o]("src",n),document.head.appendChild(a));break;case"script":a=document.createElement("script"),a[o]("type","text/javascript"),a[o]("language","javascript"),a.appendChild(document.createTextNode(n)),document.head.appendChild(a);break;case"style-link":if(r)for(i=document.head.getElementsByTagName("link"),s=i.length-1;s>=0;s--)if(n===i[s].href){l=i[s];break}l?a=l:(a=document.createElement("link"),a[o]("type","text/css"),a[o]("rel","stylesheet"),a[o]("media","all"),a[o]("href",n),document.head.appendChild(a));break;case"style":default:a=document.createElement("style"),a[o]("type","text/css"),a[o]("media","all"),a.appendChild(document.createTextNode("")),document.head.appendChild(a),n&&e(a,n)}return a}function n(e,t,n,r){var s,i,a,l,u,p,d=n.length,h=new Array(d);if(j){for(s=0;d>s;s++)h[s]=t[c](n[s].cache_id)?t[n[s].cache_id]:n[s].name in e?e[n[s].name]:require(n[s].path)||null;return r.apply(e,h)}if(T){for(s=0;d>s;s++)t[c](n[s].cache_id)?h[s]=t[n[s].cache_id]:n[s].name in e?h[s]=e[n[s].name]:(importScripts(n[s].path),h[s]=e[n[s].name]||null);return r.apply(e,h)}l=document.getElementsByTagName("head")[0],i=0,s=0,u=function(e,t,n){var r,s;(s=document.getElementById(e))&&"script"===s.tagName.toLowerCase()?n():(r=0,s=document.createElement("script"),s[o]("id",e),s[o]("type","text/javascript"),s[o]("language","javascript"),s.onload=s.onreadystatechange=function(){r||s.readyState&&"loaded"!=s.readyState&&"complete"!=s.readyState||(r=1,s.onload=s.onreadystatechange=null),n()},s[o]("src",t),l.appendChild(s))},p=function f(){var a;(a=t[c](n[s].cache_id))||n[s].name in e?(h[s]=(a?t[n[s].cache_id]:e[n[s].name])||null,++s>=d?r.apply(e,h):(a=t[c](n[s].cache_id))||n[s].name in e?(h[s]=(a?t[n[s].cache_id]:e[n[s].name])||null,f()):(e[n[s].name]=null,u(n[s].cache_id,n[s].path,f))):++i<4?setTimeout(f,20):(i=0,e[n[s++].name]=null,f())};for(;d>s&&((a=t[c](n[s].cache_id))||n[s].name in e);)h[s]=(a?t[n[s].cache_id]:e[n[s].name])||null,s++;d>s?u(n[s].cache_id,n[s].path,p):r.apply(e,h)}function r(e){return e.split(b).join(x)}function s(e){return e.split(x).join(b)}function i(){var e,t,n,i,a,l,c,o,u,d=arguments,h=d.length,f=_;if(!h)return".";if(e=p.call(d,r).join(f),t=e.length,!t)return".";for(n=e.charAt(0),i=e.charAt(t-1),a=e.split(v).filter(Boolean),l=[],c=0,o=a.length-1;o>=0;)u=a[o],".."===u?c++:"."!==u&&(c?c--:l.push(a[o])),o--;return e=l.reverse().join(f),e||n||(e="."),e&&i===f&&(e+=f),(n===f?f:"")+s(e)}var a,l="prototype",c="hasOwnProperty",o="setAttribute",u=Object[l].toString,p=Array[l].map,d=function(e){return"function"==typeof e},h=function(e){return e instanceof String||"[object String]"===u.call(e)},f=function(e){return e instanceof Array||"[object Array]"===u.call(e)},m=function(e){if(!e)return!0;var t=u.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length},g=function(e){return f(e)?e:[e]},y=String[l].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},_="/",v=/\/|\\/g,b="://",x="#PROTOCOL#",j="undefined"!=typeof global&&"[object global]"===u.call(global),T=!j&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,E=!j&&!T&&"undefined"!=typeof navigator,A=j?global:this,S=j?function(e,t){return require("fs").readFileSync(e,{encoding:t})}:function(e,t){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n.open("GET",e,!1),n.setRequestHeader("Content-Type","text/plain; charset="+t),n.overrideMimeType("text/plain; charset="+t),n.send(null),200===n.status?n.responseText:""},C=j?function(e,t,n){return require("fs").readFile(e,{encoding:t},function(e,t){n&&n(e?"":t)}),""}:function(e,t,n){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open("GET",e,!0),r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t),r.responseType="text",r.onload=function(){n&&n(200===r.status?r.responseText:"")},r.send(null),""};if(a=function B(e,t){var n=this;return n instanceof B?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},void(n._cache={})):new B(e,t)},a.VERSION="0.2.0",a.BASE="./",a.join_path=i,a[l]={constructor:a,base:null,base_url:null,_classes:null,_assets:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._cache=null,e.base=null,e.base_url=null,e},base_path:function(e,t){var n=this;return h(e)&&e.length?n.base=e:!1===e&&(n.base=""),h(t)&&t.length?n.base_url=t:!1===t&&(n.base_url=""),n},get_path:function(e,t){return m(e)?t||"":!m(t)&&(y(e,"./")||y(e,"../")||y(e,".\\")||y(e,"..\\"))?i(t,e):e},path:function(e){var t=this;return t.get_path(e||"",j?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(e,t){var n,r,s,i,a,l,c,o,u,p=this,d=p._classes,y=p._assets;if(f(t)&&t.length)if(f(t[0])||(t=[t]),"classes"===e)for(n=0,r=t.length;r>n;n++)i=t[n],s=i[0],a=i[1],l=i[2],c=i[3]?i[3]:[],m(s)||m(a)||m(l)||(d[a]=[s,a,p.path(l),g(c),!1]);else if("assets"===e)for(n=0,r=t.length;r>n;n++)i=t[n],o=i[0],a=i[1],u=i[2],c=i[3]?i[3]:[],m(o)||m(a)||m(u)||(y[a]=[o.toLowerCase(),a,h(u)?p.path_url(u):u,g(c),!1,!1]);return p},import_class:function(e,t){var r,s,i,a,l,o,u,p,h=this,f=h._classes,g="class-"+e,y=h._cache;if(y[c](g))d(t)&&t.call(h,y[g]);else{for(s=!1,p=[],r=[e];r.length;)if(e=r[0],f[c](e)&&!f[e][4])if(s=!0,A[c](f[e][0]))y["class-"+e]=A[f[e][0]];else{if(u=f[e][3],!m(u)){for(i=!1,a=u.length,l=a-1;l>=0;l--)o=u[l],f[c](o)&&!f[o][4]&&(i=!0,r.unshift(o));if(i)continue;r.shift()}f[e][4]=!0,p.push({id:e,cache_id:"class-"+e,name:f[e][0],path:f[e][2]})}else f[c](e)?(s=!0,r.shift()):r.shift();s&&p.length?n(A,y,p,function(){var e,n,r=arguments;for(e=0,n=r.length;n>e;e++)y[p[e].cache_id]=r[e];d(t)&&t.call(h,y[g])}):d(t)&&t.call(h,null)}return h},import_asset:function(e){for(var n,r,s,i,a,l,u,p,d,h,m,g,y,_=this,v=[e],b=_._assets,x=[];v.length;)if(e=v[0],b[c](e)&&b[e][4]&&!b[e][5]){if(l=b[e],u=l[0],e=l[1],p=l[2],n=l[3],n&&n.length){for(r=!1,s=n.length,i=s-1;i>=0;i--)a=n[i],b[c](a)&&!b[a][5]&&(b[a][4]=!0,r=!0,v.unshift(a));if(r)continue;v.shift()}d="styles"===u,h="scripts"===u,m="templates"===u,g=f(p),d?E?(x.push(y=g?document.getElementById("importer-inline-style-"+e)||t("style",p[0]):document.getElementById("importer-style-"+e)||t("style-link",p,!0)),y[o]("id",g?"importer-inline-style-"+e:"importer-style-"+e)):x.push(g?'<style id="importer-inline-style-'+e+'" type="text/css" media="all">'+p[0]+"</style>":'<link id="importer-style-'+e+'" type="text/css" rel="stylesheet" href="'+p+'" media="all" />'):h?E?(x.push(y=g?document.getElementById("importer-inline-script-"+e)||t("script","/*<![CDATA[*/ "+p[0]+" /*]]>*/"):document.getElementById("importer-script-"+e)||t("script-link",p,!0)),y[o]("id",g?"importer-inline-script-"+e:"importer-script-"+e)):x.push(g?'<script id="importer-inline-script-'+e+'" type="text/javascript">/*<![CDATA[*/ '+p[0]+" /*]]>*/</script>":'<script id="importer-script-'+e+'" type="text/javascript" src="'+p+'"></script>'):m?E?(x.push(y=g?document.getElementById("importer-inline-tpl-"+e)||t("tpl",p[0]):document.getElementById("importer-tpl-"+e)||t("tpl-link",p,!0)),y[o]("id",g?"importer-inline-tpl-"+e:"importer-tpl-"+e)):x.push(g?'<script id="importer-inline-tpl-'+e+'" type="text/x-tpl">'+p[0]+"</script>":'<script id="importer-tpl-'+e+'" type="text/x-tpl">'+p+"</script>"):x.push(g?p[0]:p),l[5]=!0}else v.shift();return x},enqueue:function(e,t,n,r){var s=this,i=s._assets;return m(e)||m(t)||(i[c](t)?i[t][4]=!0:m(n)||(s.register("assets",[e,t,n,r]),s._assets[t][4]=!0)),s},assets:function(e){var t,n,r,s,i,a=this,l=a._assets,o=[];arguments.length||(e="scripts"),e=e.toLowerCase();for(n in l)l[c](n)&&(r=l[n],e===r[0]&&r[4]&&!r[5]&&o.push(r[1]));if(E){for(s=0,i=o.length;i>s;s++)a.import_asset(o[s]);t=""}else{for(t=[],s=0,i=o.length;i>s;s++)t=t.concat(a.import_asset(o[s]));t=t.join("\n")}return t},getFile:function(e,t,n){var r,s=this;return e=s.path(e),t=t||{},r=t.encoding||"utf8",n=n||t.complete||d(t)&&t,E?C(e,r,function(e){d(n)&&n(e)}):d(n)?C(e,r,n):S(e,r)},importClass:function(e,t,n,r){var s=this,i=arguments.length;return 4>i&&d(n)?(r=n,n=null):3>i&&d(t)&&(r=t,t=null,n=null),s._classes[c](e)||m(t)||s.register("classes",[e,e,s.path(t+".js"),n]),s._classes[c](e)&&!s._classes[e][4]?s.import_class(e,r):d(r)&&r.call(s,s._cache["class-"+e]||null),s},importAll:function(e,t){var n,r,s,i,a=this;return e=g(e),r=e.length,s=new Array(r),n=0,i=function l(i){arguments.length&&(s[n]=i||null,n++),r>n?a.import_class(e[n],l):d(t)&&setTimeout(function(){t.apply(a,s)},10)},i(),a}},j)a.BASE=__dirname;else if(T)a.BASE=this.location.href.split("/").slice(0,-1).join("/");else{var k=document.getElementsByTagName("script"),w=document.createElement("a");w.href=k[k.length-1].src||"./",a.BASE=w.href.split("/").slice(0,-1).join("/")}return a});